<div class="journalEntries ui-g">

  <div class="header ui-g-12">
    <h2>Journal Entries</h2>

    <button type="button" (click)="showAddDialog()" class="pull-right ui-button-success" pButton label="Add New"
      icon="fa fa-plus"></button>
  </div>

  <p-table [value]="journalEntries">
    <ng-template pTemplate="header">
      <tr>
        <!-- <th>Id</th> -->        
        <th>Date</th>
        <th>Ref No</th>
        <th>Debit</th>
        <th pSortableColumn="credit">Credit <p-sortIcon field="credit"></p-sortIcon></th>
        <th>Ready For Posting</th>
        <th>Posted</th>
        <th>Action</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-entry>
      <tr>
        <td>{{entry.date | date: 'dd.MM.yyyy'}}</td>
        <td>{{entry.referenceNo}}</td>
        <td>{{entry.debit | number}}</td>
        <td>{{entry.credit | number}}</td>
        <!-- <td>{{entry.posted}}</td> -->
        <td><p-checkbox [(ngModel)]="entry.readyForPosting" [binary]="true" [readonly]="true"> </p-checkbox></td>
        <td> <p-checkbox [(ngModel)]="entry.posted" [binary]="true" [readonly]="true"> </p-checkbox></td>
        <td>
          <button id="{{ 'editJournalBtn' + entry.id}}" (click)="editEntry(entry.id)" pButton [disabled]="false" icon="fa fa-file-text-o" class="ui-button-secondary"></button>&nbsp;
          <button id="{{ 'deleteJournalBtn' + entry.id}}" (click)="deleteEntry(entry.id)" pButton [disabled]="entry.posted" icon="fa fa-times" class="ui-button-danger"></button>&nbsp;
          <button id="{{ 'postJournalBtn' + entry.id}}" (click)="postEntry(entry.id)" pButton [disabled]="entry.posted || !entry.readyForPosting" icon="fa fa-chevron-right " class="ui-button-success"></button>

        </td>

      </tr>
    </ng-template>
  </p-table>

</div>


<p-dialog [(visible)]="display" modal="true" [contentStyle]="{minHeight: '70vh'}">

  <p-header>{{dialogTitle}}</p-header>

  <form [formGroup]="JournalEntryForm" (ngSubmit)="saveEntry()" #documentEditForm="ngForm">
    
    <!-- Master -->
    <div class="ui-fluid">

            <!-- Id -->
            <div class="p-field p-grid">
              <label for="date" class="p-col-12 p-md-2">Id</label>
              <div class="p-col-12 p-md-10">
                <input type="number" readonly formControlName="id" />
              </div>
            </div>

      <!-- Date -->
      <div class="p-field p-grid">
        <label for="date" class="p-col-12 p-md-2">Date*</label>
        <div class="p-col-12 p-md-10">
          <p-calendar [showIcon]="true" formControlName="date" required></p-calendar>
        </div>
      </div>

      <!-- RefNo -->
      <div class="p-field p-grid">
        <label for="referenceNo" class="p-col-12 p-md-2">Ref. No*</label>
        <div class="p-col-12 p-md-10">
          <input type="text" pInputText formControlName="referenceNo" required  />
        </div>
      </div>

    

      <!-- Posted -->
      <!-- <div class="ui-g">
          <label for="Posted" class="ui-g-3">Posted</label>
          <p-checkbox class="ui-g-9" [formControl]="JournalEntryForm.controls['posted']" [binary]="true"
            [readonly]="true"> </p-checkbox>
        </div> -->

    </div>

    <hr>
 
    <table >
      <tr>
        <th>Account</th>
        <th>Dr/Cr</th>
        <th>Amount</th>
        <th>Memo</th>
        <th></th>
      </tr>

      <tbody formArrayName="lines" *ngFor="let line of lines.controls; let i = index">

        <tr [formGroupName]="i">
          <!-- Account DropDown -->
          <td>
            <p-dropdown id="{{ 'accountId' + i}}" [options]="accounts" formControlName="accountId"
              optionLabel="name"></p-dropdown>
          </td>

          <!-- Dr/Cr DropDown -->
          <td>
            <p-dropdown id="{{ 'drcrId' + i}}" [options]="drcr" formControlName="drcrId" optionLabel="name">
            </p-dropdown>
          </td>

          <!-- Amount Field -->
          <td>
            <p-inputNumber id="{{ 'amountId' + i}}" formControlName="lineAmount" mode="decimal">
            </p-inputNumber>
          </td>

          <!-- Memo Field -->
          <td><input id="{{ 'memoId' + i}}" type="text" pInputText name="lineMemo" formControlName="lineMemo" /></td>

          <!-- Actions -->
          <td><button id="{{ 'deleteButtonId' + i}}" (click)="deleteLine(i)" pButton [disabled]="false" icon="fa fa-times" class="ui-button-danger"></button></td>

        </tr>

      </tbody>

    </table>

  </form>

  <p-footer>

    <!-- Button AddLine -->
    <button pButton class="pull-left ui-button-success" label="Add Line" (click)="addLine()" [disabled]="!lines.valid"
      icon="fa fa-plus"></button>


    <button type="button" (click)="closeDialog()" class="pull-right ui-button-secondary" pButton label="Close"
      icon="fa fa-times"></button>

    <button type="button" (click)="documentEditForm.ngSubmit.emit()" [disabled]="!documentEditForm.form.valid"
      class="pull-right ui-button-primary" pButton label="Save" icon="fa fa-floppy-o"></button>

  </p-footer>

</p-dialog>